(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1effe4bb"],{"0022":function(t,e,r){},"2c86":function(t,e,r){"use strict";r("753e")},"42e3":function(t,e,r){"use strict";r.d(e,"a",(function(){return o})),r.d(e,"E",(function(){return i})),r.d(e,"O",(function(){return s})),r.d(e,"m",(function(){return a})),r.d(e,"o",(function(){return c})),r.d(e,"e",(function(){return u})),r.d(e,"q",(function(){return d})),r.d(e,"t",(function(){return f})),r.d(e,"u",(function(){return l})),r.d(e,"z",(function(){return m})),r.d(e,"C",(function(){return h})),r.d(e,"A",(function(){return p})),r.d(e,"L",(function(){return _})),r.d(e,"M",(function(){return g})),r.d(e,"K",(function(){return v})),r.d(e,"P",(function(){return b})),r.d(e,"Q",(function(){return k})),r.d(e,"I",(function(){return I})),r.d(e,"k",(function(){return O})),r.d(e,"B",(function(){return j})),r.d(e,"v",(function(){return w})),r.d(e,"s",(function(){return y})),r.d(e,"r",(function(){return C})),r.d(e,"w",(function(){return x})),r.d(e,"p",(function(){return T})),r.d(e,"l",(function(){return $})),r.d(e,"G",(function(){return B})),r.d(e,"H",(function(){return S})),r.d(e,"c",(function(){return L})),r.d(e,"b",(function(){return M})),r.d(e,"f",(function(){return U})),r.d(e,"F",(function(){return D})),r.d(e,"x",(function(){return E})),r.d(e,"N",(function(){return P})),r.d(e,"D",(function(){return z})),r.d(e,"n",(function(){return F})),r.d(e,"J",(function(){return G})),r.d(e,"i",(function(){return N})),r.d(e,"d",(function(){return q})),r.d(e,"g",(function(){return A})),r.d(e,"h",(function(){return J})),r.d(e,"j",(function(){return W})),r.d(e,"y",(function(){return H}));var n=r("6b6c");function o(t){return Object(n["a"])({url:"/login",method:"post",data:t,kefu:!0})}function i(t){return Object(n["a"])({url:"/user/record",method:"get",params:t,kefu:!0})}function s(t){return Object(n["a"])({url:"/user/info/"+t,method:"get",kefu:!0})}function a(t,e){return Object(n["a"])({url:"/order/list/"+t,method:"get",params:e,kefu:!0})}function c(t,e){return Object(n["a"])({url:"/order/delivery/"+t,method:"post",data:e,kefu:!0})}function u(t,e){return Object(n["a"])({url:"/order/update/".concat(t),method:"put",data:e,kefu:!0})}function d(t){return Object(n["a"])({url:"order/edit/"+t,method:"get",kefu:!0})}function f(t){return Object(n["a"])({url:"order/refund_form/"+t,method:"get",kefu:!0})}function l(t){return Object(n["a"])({url:"order/refund",method:"post",data:t,kefu:!0})}function m(t,e){return Object(n["a"])({url:"product/cart/"+t,method:"get",params:e,kefu:!0})}function h(t,e){return Object(n["a"])({url:"product/visit/"+t,method:"get",params:e,kefu:!0})}function p(t,e){return Object(n["a"])({url:"product/hot/"+t,method:"get",params:e,kefu:!0})}function _(t){return Object(n["a"])({url:"service/speechcraft",method:"get",params:t,kefu:!0})}function g(t){return Object(n["a"])({url:"service/transfer_list",method:"get",params:t,kefu:!0})}function v(t){return Object(n["a"])({url:"service/transfer",method:"post",params:t,kefu:!0})}function b(t){return Object(n["a"])({url:"user/label/".concat(t),method:"get",kefu:!0})}function k(t,e){return Object(n["a"])({url:"user/label/".concat(t),method:"put",data:e,kefu:!0})}function I(t){return Object(n["a"])({url:"service/list",method:"get",params:t,kefu:!0})}function O(){return Object(n["a"])({url:"/key",method:"get",kefu:!0})}function j(t){return Object(n["a"])({url:"product/info/".concat(t),method:"get",kefu:!0})}function w(t){return Object(n["a"])({url:"/order/remark",method:"post",data:t,kefu:!0})}function y(t){return Object(n["a"])({url:"/order/info/"+t,method:"get",kefu:!0})}function C(){return Object(n["a"])({url:"/order/export",method:"get",kefu:!0})}function x(t){return Object(n["a"])({url:"/order/temp",method:"get",params:t,kefu:!0})}function T(){return Object(n["a"])({url:"/order/delivery_all",method:"get",kefu:!0})}function $(){return Object(n["a"])({url:"/order/delivery_info",method:"get",kefu:!0})}function B(t){return Object(n["a"])({url:"/service/cate",method:"get",params:t,kefu:!0})}function S(t,e){return Object(n["a"])({url:"service/speechcraft/"+t,method:"PUT",params:e,kefu:!0})}function L(t){return Object(n["a"])({url:"service/speechcraft",method:"post",data:t,kefu:!0})}function M(t){return Object(n["a"])({url:"service/cate",method:"post",data:t,kefu:!0})}function U(t,e){return Object(n["a"])({url:"service/cate/"+t,method:"PUT",params:e,kefu:!0})}function D(t,e){return Object(n["a"])({url:"scan/"+t,method:"get",params:e,kefu:!0})}function E(t){return Object(n["a"])({url:"/order/verific/".concat(t),method:"get",kefu:!0})}function P(){return Object(n["a"])({url:"user/group",method:"get",kefu:!0})}function z(t,e){return Object(n["a"])({url:"user/group/".concat(t,"/").concat(e),method:"put",kefu:!0})}function F(){return Object(n["a"])({url:"config",method:"get",kefu:!0})}function G(t){return Object(n["a"])({url:"tourist/user",method:"get",params:t,kefu:!0})}function N(){return Object(n["a"])({url:"tourist/adv",method:"get",kefu:!0})}function q(t){return Object(n["a"])({url:"tourist/chat",method:"get",params:t,kefu:!0})}function A(){return Object(n["a"])({url:"tourist/feedback",method:"get",kefu:!0})}function J(t){return Object(n["a"])({url:"tourist/feedback",method:"post",data:t,kefu:!0})}function W(t,e){return Object(n["a"])({url:"tourist/order/".concat(t),method:"get",params:e,kefu:!0})}function H(t){return Object(n["a"])({url:"tourist/product/".concat(t),method:"get",kefu:!0})}},6599:function(t,e,r){"use strict";r("0022")},"753e":function(t,e,r){},7624:function(t,e,r){"use strict";e["a"]=["em-smile","em-laughing","em-blush","em-smiley","em-relaxed","em-smirk","em-heart_eyes","em-kissing_heart","em-kissing_closed_eyes","em-flushed","em-relieved","em-satisfied","em-grin","em-wink","em-stuck_out_tongue_winking_eye","em-stuck_out_tongue_closed_eyes","em-grinning","em-kissing","em-kissing_smiling_eyes","em-stuck_out_tongue","em-sleeping","em-worried","em-frowning","em-anguished","em-open_mouth","em-grimacing","em-confused","em-hushed","em-expressionless","em-unamused","em-sweat_smile","em-sweat","em-disappointed_relieved","em-weary","em-pensive","em-disappointed","em-confounded","em-fearful","em-cold_sweat","em-persevere","em-cry","em-sob","em-joy","em-astonished","em-scream","em-tired_face","em-angry","em-rage","em-triumph","em-sleepy","em-yum","em-mask","em-sunglasses","em-dizzy_face","em-imp","em-smiling_imp","em-neutral_face","em-no_mouth","em-innocent","em-alien"]},c168:function(t,e,r){"use strict";r.r(e);var n=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"chat-box"},[t.productId&&t.productInfo.id?r("div",{staticClass:"broadcast-details_box"},[r("div",{staticClass:"broadcast_details_img"},[r("img",{attrs:{src:t.productInfo.image}})]),r("div",{staticClass:"broadcast_details_picBox"},[r("div",{staticClass:"broadcast_details_tit",domProps:{textContent:t._s(t.productInfo.store_name)}}),r("div",{staticClass:"acea-row row-between"},[r("div",{staticClass:"broadcast_details_pic"},[t._v("\n                    ￥"+t._s(t.productInfo.price)),r("span",{staticClass:"broadcast_details_pic_num"},[t._v("￥"+t._s(t.productInfo.ot_price))])]),r("div",{staticClass:"broadcast_details_btn",on:{click:t.sendProduct}},[t._v("发送客服")])])])]):t._e(),t.orderId&&t.orderInfo.id?r("div",{staticClass:"broadcast_box"},[r("div",{staticClass:"broadcast-details_num broadcast_num"},[r("span",[t._v("订单号："+t._s(t.orderInfo.order_id))]),r("span",[t._v(t._s(t.orderInfo.add_time_y)+" "+t._s(t.orderInfo.add_time_h))])]),r("div",{staticClass:"broadcast-details_box"},[r("div",{staticClass:"broadcast_details_img"},[r("img",{attrs:{src:t.cartInfo.productInfo.image}}),r("div",{staticClass:"broadcast_details_model"},[t._v("\n                    "+t._s(t.orderInfo.cartInfo?t.orderInfo.cartInfo.length:0)+"件商品\n                ")])]),r("div",{staticClass:"broadcast_details_picBox"},[r("div",{staticClass:"broadcast_details_tit"},[t._v("\n                    "+t._s(t.cartInfo.productInfo.store_name)+"\n                ")]),r("div",{staticClass:"acea-row row-between"},[r("div",{staticClass:"broadcast_details_pic"},[t._v("\n                        ￥"+t._s(t.cartInfo.productInfo.price)),r("text",{staticClass:"broadcast_details_pic_num"},[t._v("￥"+t._s(t.cartInfo.productInfo.ot_price))])]),r("div",{staticClass:"broadcast_details_btn",on:{click:t.sendOrder}},[t._v("\n                        发送客服\n                    ")])])])])]):t._e(),r("div",{staticClass:"chat-scroll-box"},[r("vue-scroll",{ref:"scrollBox",attrs:{ops:t.ops},on:{"refresh-activate":t.handleActivate,"refresh-start":t.handleStart,"refresh-before-deactivate":t.handleBeforeDeactivate,"refresh-deactivate":t.handleDeactivate}},[r("div",{staticClass:"slot-refresh",attrs:{slot:"refresh-deactive"},slot:"refresh-deactive"}),r("div",{staticClass:"slot-refresh",attrs:{slot:"refresh-beforeDeactive"},slot:"refresh-beforeDeactive"}),r("div",{ref:"chat",staticClass:"chat",staticStyle:{padding:".3rem"},attrs:{id:"chatBox"}},t._l(t.records,(function(e,n){return r("div",{key:n,attrs:{id:"chat_"+e.id}},[e.show?r("div",{staticClass:"day-box"},[t._v(t._s(e.time))]):t._e(),r("div",{staticClass:"chat-item",class:{"right-box":e.to_uid==t.toUid}},[r("img",{staticClass:"avatar",attrs:{src:e.avatar,mode:""}}),1==e.msn_type?r("div",{staticClass:"msg-box",domProps:{innerHTML:t._s(e.msn)}}):t._e(),3==e.msn_type?r("div",{directives:[{name:"viewer",rawName:"v-viewer"}],staticClass:"img-box"},[r("img",{directives:[{name:"lazy",rawName:"v-lazy",value:e.msn,expression:"item.msn"}],attrs:{mode:"widthFix"}})]):t._e(),5==e.msn_type?r("div",{staticClass:"product-box",on:{click:function(r){return t.goProduct(e)}}},[r("img",{attrs:{src:e.productInfo.image}}),r("div",{staticClass:"info"},[r("div",{staticClass:"price"},[r("span",[t._v("￥")]),t._v(t._s(e.productInfo.price))]),r("div",{staticClass:"name line2"},[t._v(t._s(e.productInfo.store_name))])])]):t._e(),6==e.msn_type?r("div",{staticClass:"order-box",on:{click:function(r){return t.goOrderDetail(e)}}},[r("div",{staticClass:"title"},[t._v("订单ID: "+t._s(e.orderInfo.order_id))]),r("div",{staticClass:"info"},[r("img",{attrs:{src:e.orderInfo.cartInfo[0].productInfo.image}}),r("div",{staticClass:"product-info"},[r("div",{staticClass:"name line2"},[t._v(t._s(e.orderInfo.cartInfo[0].productInfo.store_name))]),r("div",{staticClass:"price"},[t._v("¥"+t._s(e.orderInfo.cartInfo[0].productInfo.price))])])])]):t._e()])])})),0)])],1),r("div",{staticClass:"footer-box"},[t.userToken?r("div",{staticClass:"words",on:{click:t.showWords}},[r("Upload",{staticStyle:{"margin-top":"1px",display:"inline-block"},attrs:{"show-upload-list":!1,action:t.fileUrl,"before-upload":t.beforeUpload,data:t.uploadData,headers:t.header,multiple:!0,"on-success":t.handleSuccess,format:["jpg","jpeg","png","gif"],"on-format-error":t.handleFormatError}},[r("span",{staticClass:"iconfont icontupian3"})])],1):t._e(),r("div",{staticClass:"input-box"},[r("Input",{attrs:{placeholder:"请输入内容"},model:{value:t.con,callback:function(e){t.con=e},expression:"con"}}),r("span",{staticClass:"iconfont iconfasong",class:{isSend:t.isSend},on:{click:t.sendText}})],1),r("div",{staticClass:"emoji",on:{click:function(e){return t.openBox(1)}}},[r("span",{staticClass:"iconfont iconbiaoqing2"})])]),r("div",{directives:[{name:"show",rawName:"v-show",value:t.isSwiper,expression:"isSwiper"}],staticClass:"banner slider-banner"},[r("swiper",{ref:"mySwiper",staticClass:"swiper-wrapper",attrs:{options:t.swiperOptions}},t._l(t.emojiGroup,(function(e,n){return r("swiper-slide",{key:n},t._l(e,(function(e){return r("i",{key:e,staticClass:"em",class:e,on:{click:function(r){return t.addEmoji(e)}}})})),0)})),1)],1)])},o=[],i=r("2909"),s=(r("a481"),r("ac6a"),r("d708")),a=r("49ea"),c=r("c276"),u=r("7624"),d=r("42e3"),f=function(t,e){e=1*e||1;var r=[];return t.forEach((function(t,n){n%e===0&&r.push([]),r[r.length-1].push(t)})),r},l={name:"chat_mobile",data:function(){return{ops:{vuescroll:{mode:"slide",enable:!1,auto:!1,autoLoadDistance:0,pullRefresh:{enable:!0,auto:!1,autoLoadDistance:0,tips:{deactive:"",active:"上拉加载更多",start:"Loading...",beforeDeactive:" "}},pushLoad:{enable:!1}},bar:{background:"#393232",opacity:".5",size:"2px"}},swiperOptions:{},status:!1,loading:!1,isTool:!1,isSwiper:!1,isWords:!1,autoplay:!1,circular:!0,interval:3e3,duration:500,emojiGroup:f(u["a"],21),con:"",toUid:"",limit:15,upperId:0,chatList:[],kefuInfo:{},scrollTop:0,active:!0,isScroll:!0,oldHeight:0,selector:"",transferList:[],isTransfer:!1,uploadData:{},header:{},fileUrl:"",userToken:"",tourist_uid:"",orderId:"",orderInfo:"",cartInfo:"",productId:"",productInfo:"",tourist_avatar:""}},computed:{isSend:function(){return 0!=this.con.length},records:function(){var t=this;return this.chatList.map((function(e,r){return e.time=t.$moment(1e3*e.add_time).format("MMMDo h:mm"),r?e.add_time-t.chatList[r-1].add_time>=300?e.show=!0:e.show=!1:e.show=!0,e}))}},created:function(){var t=localStorage.getItem("LOGIN_STATUS_TOKEN")||"";this.fileUrl=s["a"].apiBaseURL.replace("adminapi","kefuapi")+"/tourist/upload",this.userToken=t,this.toUid=this.$route.query.toUid||"",this.nickname=this.$route.query.nickname||"",this.orderId=this.$route.query.orderId||"",this.productId=this.$route.query.product_id||""},mounted:function(){var t=this;this.$wechat._isMobile()||this.$router.replace("/kefu/appChat");var e=this;this.getServiceList(),this.userToken&&(this.getOrderInfo(),this.getGoodsInfo()),this.header["Authori-zation"]="Bearer "+Object(c["d"])("kefu_token"),a["a"].then((function(r){t.userToken&&r.send({type:"login",data:t.userToken}),r.$on(["reply","chat"],(function(e){1!=e.msn_type&&2!=e.msn_type||(e.msn=t.replace_em(e.msn)),t.chatList.push(e),t.$nextTick((function(){t.$refs["scrollBox"].refresh(),t.scrollBom()})),setTimeout((function(e){t.$refs["scrollBox"].refresh()}),300)})),r.$on("socket_error",(function(){t.$Message.error("连接失败")})),r.$on("error",(function(){t.$Message.error("连接失败")})),r.$on("to_transfer",(function(t){r.send({data:{id:t.toUid},type:"to_chat"})})),r.$on("online",(function(t){0==t.online&&t.uid==e.toUid&&e.$Modal.confirm({title:"提示",content:"客服已离线，是否需要反馈？",okText:"确定",cancelText:"取消",onOk:function(){e.$router.replace({path:"/kefu/mobile_feedback"})}})}))})),this.$nextTick((function(){}))},methods:{handleFormatError:function(t){this.$Message.error("上传图片只能是 jpg、jpg、jpeg、gif 格式!")},getGoodsInfo:function(){var t=this;this.productId&&Object(d["y"])(this.productId).then((function(e){t.productInfo=e.data})).catch((function(e){t.$Message.error(e.msg)}))},getOrderInfo:function(){var t=this;this.orderId&&Object(d["j"])(this.orderId,{token:this.userToken}).then((function(e){t.orderInfo=e.data,t.orderInfo.add_time_h&&(t.orderInfo.add_time_h=t.orderInfo.add_time_h.substring(0,t.orderInfo.add_time_h.lastIndexOf(":"))),t.orderInfo.cartInfo.length&&(t.cartInfo=t.orderInfo.cartInfo[0])}))},getServiceList:function(){var t=this;Object(d["J"])({token:this.userToken}).then((function(e){t.toUid=e.data.uid,t.tourist_uid=e.data.tourist_uid,document.title=e.data.nickname,t.tourist_avatar=e.data.tourist_avatar,t.userToken&&t.getChatList();var r={data:{id:e.data.uid,tourist_uid:t.tourist_uid},type:"to_chat"};a["a"].then((function(t){t.send(r)}))})).catch((function(e){t.$Message.error(e.msg),setTimeout((function(e){t.$router.replace({path:"/kefu/mobile_feedback"})}),2e3)}))},beforeUpload:function(t){var e=this,r="image/jpeg"===t.type||"image/png"===t.type;r||this.$Message.error("上传图片只能是 JPG、PNG 格式!"),this.uploadData={filename:t,token:this.userToken};var n=new Promise((function(t){e.$nextTick((function(){t(!0)}))}));return n},handleSuccess:function(t,e,r){200===t.status?(this.$Message.success(t.msg),this.sendMsg(t.data.url,3)):this.$Message.error(t.msg)},scrollBom:function(){var t=this;setTimeout((function(e){var r=parseFloat(document.getElementById("chatBox").offsetHeight);t.$refs["scrollBox"]&&t.$refs["scrollBox"].scrollTo({y:r},300)}),300)},goOrderDetail:function(t){this.$router.push({path:"/kefu/orderDetail/".concat(t.orderInfo.id)})},openBox:function(t){var e=this;1==t?(this.isTool=!1,this.isSwiper=!this.isSwiper):(this.isSwiper=!1,this.isTool=!this.isTool),this.$refs["scrollBox"].refresh(),this.$nextTick((function(){e.scrollBom()}))},showWords:function(){this.isWords=!0},goTransfer:function(){this.isTransfer=!0},closeTransfer:function(){this.transferList.forEach((function(t,e){t.isCheck=!1})),this.isTransfer=!1},goodsInfo:function(){this.$router.push({path:"/kefu/goods/list?toUid="+this.toUid})},addEmoji:function(t){var e="[".concat(t,"]");this.con+=e},replace_em:function(t){return t=t.replace(/\[em-([a-z_]*)\]/g,"<span class='em em-$1'/></span>"),t},getChatList:function(){var t=this;Object(d["d"])({limit:this.limit,uid:this.toUid,upperId:this.upperId,token:this.userToken}).then((function(e){e.data.forEach((function(e){1!=e.msn_type&&2!=e.msn_type||(e.msn=t.replace_em(e.msn))}));var r="";r=0==t.upperId?"chat_".concat(e.data[e.data.length-1].id):"chat_".concat(t.chatList[0].id),t.selector=r,t.chatList=[].concat(Object(i["a"])(e.data),Object(i["a"])(t.chatList)),t.loading=!1,t.isScroll=e.data.length>=t.limit,t.$refs["scrollBox"].refresh(),t.$nextTick((function(){t.$emit("change",!0),console.log(parseFloat(document.getElementById(r).offsetTop)-60,"getChatList");var e=parseFloat(document.getElementById(r).offsetTop)-60;t.$refs["scrollBox"].scrollTo({y:e},0)}))}))},sendOrder:function(){this.sendMsg(this.orderId,6),this.orderId=0,this.orderInfo={}},sendProduct:function(){this.sendMsg(this.productId,5),this.productId=0,this.productInfo={}},sendText:function(){this.isSend||this.$Message.error("请输入内容"),this.sendMsg(this.con,1),this.con=""},sendMsg:function(t,e){var r={type:"chat",data:{msn:t,type:e,is_tourist:this.userToken?0:1,to_uid:this.toUid,tourist_uid:this.tourist_uid,form_type:this.$wechat.isWeixin()?1:3,tourist_avatar:this.userToken?"":this.tourist_avatar}};a["a"].then((function(t){t.send(r)}))},uploadImg:function(){var t=this;t.$util.uploadImageOne("upload/image",(function(e){200==e.status&&t.sendMsg(e.data.url,3)}))},goProduct:function(t){var e=window.location.protocol+"//"+window.location.host+"/pages/goods_details/index?id="+t.msn;window.open(e,"_blank")},goAdminOrder:function(){var t=window.location.protocol+"//"+window.location.host+"/pages/users/order_details/index?order_id="+item.msn;window.open(t,"_blank")},height:function(){var t=this,e=0,r=uni.createSelectorQuery().select(".chat");setTimeout((function(n){r.boundingClientRect((function(r){console.log(r.height,"data.height"),e=r.height,t.active?t.scrollTop=parseInt(e)+500:t.scrollTop=parseInt(e)+100})).exec()}),1e3)},handleActivate:function(t,e){this.upperId=this.chatList[0].id},handleStart:function(t,e,r){setTimeout((function(){r()}),2e3)},handleBeforeDeactivate:function(t,e,r){this.userToken?(this.getChatList(),this.$on("change",(function(t){t&&r()}))):r()},handleDeactivate:function(t,e){var r=parseFloat(document.getElementById(this.selector).offsetTop)-60;console.log(r,"handleDeactivate"),this.$refs["scrollBox"].scrollTo({y:r},0)}}},m=l,h=(r("2c86"),r("6599"),r("2877")),p=Object(h["a"])(m,n,o,!1,null,"ffd165b2",null);e["default"]=p.exports}}]);